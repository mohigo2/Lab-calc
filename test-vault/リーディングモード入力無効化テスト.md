# リーディングモード入力無効化テスト

このファイルでリーディングモードにおける入力要素の無効化機能をテストしてください。

## テスト手順

1. **F12でDeveloper Consoleを開く** - デバッグログを確認
2. **このファイルをライブプレビューモードで開く** → 編集可能状態を確認
3. **リーディングモードに切り替える** → 入力無効化を確認
4. **各計算ブロックで以下を確認**：
   - 全ての入力フォーム（テキスト、数値、セレクト）が無効化されている
   - ボタンが無効化されている
   - 視覚的にグレーアウトされている
   - 「🔒 読み取り専用モード」の表示が出ている

## バッファー計算テスト

```buffer
name: リーディングモード無効化テスト
totalVolume: 1000
volumeUnit: mL
components:
  - name: Tris-HCl
    stockConc: 1
    stockUnit: M
    finalConc: 50
    finalUnit: mM
    lotNumber: ABC123
  - name: NaCl
    stockConc: 5
    stockUnit: M
    finalConc: 150
    finalUnit: mM
```

### 期待される動作（バッファー）
- ✅ タイトルに🔒アイコンが表示される
- ✅ 総体積入力フィールドが無効化される
- ✅ 体積単位セレクトが無効化される
- ✅ 各成分の試薬名入力が無効化される
- ✅ ストック濃度・最終濃度入力が無効化される
- ✅ 濃度単位セレクトが無効化される
- ✅ ロット番号入力が無効化される
- ✅ 「+ 成分を追加」ボタンが表示されない
- ✅ 「🔒 読み取り専用モード」表示が出る

## ストック溶液計算テスト

```stock
name: ストック無効化テスト
reagentName: KCl
molecularWeight: 74.55
targetConcentration: 200
concentrationUnit: mM
volume: 50
volumeUnit: mL
purity: 99.5
solvent: 蒸留水
```

### 期待される動作（ストック）
- ✅ タイトルに🔒アイコンが表示される
- ✅ 試薬名入力が無効化される
- ✅ 分子量入力が無効化される
- ✅ 目標濃度入力・単位が無効化される
- ✅ 体積入力・単位が無効化される
- ✅ 純度入力が無効化される
- ✅ 溶媒入力が無効化される
- ✅ 「🔒 読み取り専用モード」表示が出る

## 希釈計算テスト

```dilution
name: 希釈無効化テスト
stockConcentration: 1000
stockConcentrationUnit: mM
finalConcentration: 100
finalConcentrationUnit: mM
finalVolume: 100
volumeUnit: µL
```

### 期待される動作（希釈）
- ✅ タイトルに🔒アイコンが表示される
- ✅ ストック濃度入力・単位が無効化される
- ✅ 最終濃度入力・単位が無効化される
- ✅ 最終体積入力・単位が無効化される
- ✅ 「🔒 読み取り専用モード」表示が出る

## 段階希釈計算テスト

```serial-dilution
name: 段階希釈無効化テスト
stockConcentration: 10
stockUnit: mM
cellVolume: 200
cellVolumeUnit: µL
additionVolume: 2
additionVolumeUnit: µL
dilutionVolume: 200
dilutionVolumeUnit: µL
targetConcentrations: [100, 10, 1, 0.1]
targetUnit: µM
targetInputMode: exponential
stepDisplayFormat: text
```

### 期待される動作（段階希釈）
- ✅ タイトルに🔒アイコンが表示される
- ✅ ストック濃度入力・単位が無効化される
- ✅ セル体積入力・単位が無効化される
- ✅ 添加体積入力・単位が無効化される
- ✅ 希釈体積入力・単位が無効化される
- ✅ 目標濃度入力が無効化される
- ✅ 入力モード選択が無効化される
- ✅ 表示形式選択が無効化される
- ✅ 濃度追加・削除ボタンが無効化される
- ✅ 「🔒 読み取り専用モード」表示が出る

## コンソールログ確認

F12でコンソールを開いて以下のログを確認：

### リーディングモードでの期待ログ
```
=== Mode Detection Debug ===
✅ Active view found: [MarkdownView object]
📄 Active view file: [ファイルパス]
📁 Context source path: [ファイルパス]
🔍 Current view mode: preview
👀 Preview mode detected - checking submode...
📂 Same file context: true
🌐 DOM structure analysis:
   - Has .markdown-preview-view: true
   - Has .cm-editor: false
   - Has .markdown-source-view: false
📊 View state: [state object]
🔴 Reading mode detected (pure preview, no editor) - not editable
🔒 Disabled [数字] input elements for reading mode
```

### ライブプレビューモードでの期待ログ
```
=== Mode Detection Debug ===
🔍 Current view mode: preview
👀 Preview mode detected - checking submode...
🌐 DOM structure analysis:
   - Has .markdown-preview-view: true
   - Has .cm-editor: true
⚙️ Editor functional check: true
🟢 Live preview mode detected - editable
```

## 動作確認チェックリスト

### リーディングモード時
- [ ] 全ての入力要素が物理的にクリック・入力できない
- [ ] 入力要素がグレーアウトして見える
- [ ] タイトルに🔒アイコンが表示される
- [ ] 「🔒 読み取り専用モード」の表示が出る
- [ ] ボタン類が無効化されている
- [ ] コンソールに適切なデバッグログが出力される

### ライブプレビュー/ソースモード時
- [ ] 全ての入力要素が正常に操作できる
- [ ] タイトルが編集可能
- [ ] ボタン類が正常に動作する
- [ ] 入力変更がソースに反映される

## 実装確認ポイント

✅ `disableInputsForReadingMode()`メソッドが各renderメソッドで呼び出される
✅ `isEditableMode()`の判定が正しく動作する
✅ DOM要素に`buffer-calc-readonly`クラスが適用される
✅ CSSスタイルが適切に適用される
✅ 視覚的フィードバックが提供される

これでリーディングモードでは完全に読み取り専用となり、ライブプレビュー・ソースモードでは通常通り編集可能になります！