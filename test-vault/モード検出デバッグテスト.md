# モード検出デバッグテスト

このファイルでモード検出ロジックが正しく動作するかテストしてください。

## 修正内容
- エディター存在の詳細チェック
- エディター機能性の確認 (`replaceRange`, `getDoc`, `getValue`)
- より詳細なデバッグログ出力

## テスト手順

1. **F12でDeveloper Consoleを開く**
2. **このファイルをライブプレビューモードで開く**
3. **コンソールログを確認**
4. **リーディングモードに切り替える**
5. **コンソールログの変化を確認**

## テスト用計算ブロック

```buffer
name: a
totalVolume: 1000
volumeUnit: mL
components:
  - name: Test
    stockConc: 1
    stockUnit: M
    finalConc: 50
    finalUnit: mM
```

## 期待されるコンソール出力

### ライブプレビューモード時
```
=== Mode Detection Debug ===
✅ Active view found: [MarkdownView object]
📄 Active view file: [ファイルパス]
📁 Context source path: [ファイルパス]
🔍 Current view mode: preview
👀 Preview mode detected - checking submode...
📂 Same file context: true
📊 View state mode: [モード情報]
📝 Editor exists: true
⚙️ Editor functional: true
🎭 Current mode type: [モードタイプ]
🟢 Live preview mode detected (editor accessible) - editable
🎯 Buffer Calculator - isEditable: true
📝 Creating editable title for buffer
```

### リーディングモード時
```
=== Mode Detection Debug ===
✅ Active view found: [MarkdownView object]
📄 Active view file: [ファイルパス]  
📁 Context source path: [ファイルパス]
🔍 Current view mode: preview
👀 Preview mode detected - checking submode...
📂 Same file context: true
📊 View state mode: [モード情報]
📝 Editor exists: false/true
⚙️ Editor functional: false
🎭 Current mode type: [モードタイプ]
🔴 Reading mode detected (no functional editor) - not editable
🎯 Buffer Calculator - isEditable: false
🔒 Creating readonly title for buffer
🔒 Disabled [数字] input elements for reading mode (title area preserved)
```

## デバッグ情報を確認してください

現在のコンソール出力を確認して、以下の情報を教えてください：

1. **View State Mode**: `📊 View state mode:` の値
2. **Editor Exists**: `📝 Editor exists:` の値 
3. **Editor Functional**: `⚙️ Editor functional:` の値
4. **Current Mode Type**: `🎭 Current mode type:` の値

これらの値を確認することで、Obsidianの実際の内部構造を理解し、正確な検出ロジックを構築できます。

## 追加テスト項目

### 各モードで確認すべき点

**ソースモード**
- [ ] `🔍 Current view mode: source` 
- [ ] `✏️ Source mode detected - editable`
- [ ] `🎯 Buffer Calculator - isEditable: true`

**ライブプレビューモード**  
- [ ] `🔍 Current view mode: preview`
- [ ] `⚙️ Editor functional: true`
- [ ] `🟢 Live preview mode detected (editor accessible) - editable`
- [ ] `🎯 Buffer Calculator - isEditable: true`

**リーディングモード**
- [ ] `🔍 Current view mode: preview` 
- [ ] `⚙️ Editor functional: false`
- [ ] `🔴 Reading mode detected (no functional editor) - not editable`
- [ ] `🎯 Buffer Calculator - isEditable: false`

実際の出力を確認して、問題があれば詳細を教えてください！